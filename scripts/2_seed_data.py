"""
Script 2: Seed food_menu table with Indonesian menu data
Run with: python scripts/2_seed_data.py
"""
import psycopg2
import os
from dotenv import load_dotenv

# Load environment variables
load_dotenv(os.path.join(os.path.dirname(__file__), '..', 'food_analyst_agent_adk', '.env'))

# All INSERT statements from oretan-for-scripts.md
SEED_SQL = """
INSERT INTO public.food_menu (nama_menu,kategori,asal,deskripsi,kalori,protein,lemak,karbohidrat,serat,garam,tingkat_kesehatan,harga,cocok_untuk,embedding,created_at) VALUES
	 ('Nasi Goreng Spesial','Nasi Goreng','Jawa Timur','Nasi goreng dengan telur, daging ayam, udang, kacang polong, wortel, dan bumbu khas',450,18,12,58,3,1.8,'Baik','Rp 45.000','{Sarapan,Makan Siang,Diet Tinggi Protein}','[-0.10262577,-0.014548312,0.0089897355,0.017639289,-0.02372589,0.010170165,0.058257207,0.06507267,-0.03322518,-0.015012463,0.07707873,-0.027307186,-0.076698884,-0.0497276,0.033532225,-0.016458903,0.028324798,0.019137526,-0.0063200686,-0.124337845,0.05506417,0.02655275,-0.0317861,-0.029321574,0.00295255,-0.08858157,0.064533666,-0.038805574,0.012177652,-0.064132646,-0.0024451758,0.08961398,0.032458603,-0.061505955,-0.0552063,0.086882226,-0.041145053,-0.1380605,-0.015133829,-0.049411125,0.04301182,0.0031408176,0.03166784,-0.14011565,0.025260909,-0.060050882,-0.06518218,0.050647467,0.045080543,-0.007172296,-0.11471404,-0.041330207,-0.025034627,-0.039268136,0.045662653,-0.069438264,-0.06646746,-0.013611082,-0.07966198,0.018839441,-0.00021063956,0.0408269,-0.025934292,-0.03703973,0.11011061,-0.06580617,-0.013294077,0.058360253,0.017741548,0.02857177,-0.033994604,-0.049305826,-0.03019657,0.08923677,-0.10326522,0.08745685,0.0060411072,-0.008000964,0.05384853,-0.06519223,-0.025149016,0.022204375,0.09495833,0.06658331,-0.013002708,0.044247225,-0.07047119,0.069145866,-0.025698993,0.032181654,0.061066147,0.03402237,-0.034674734,0.015805922,-0.06182931,-0.029410064,-0.044299185,-0.09271125,-0.004781054,-0.009521487,0.015023466,-0.023791637,0.08573562,-0.093347535,-0.08177873,-0.015027666,-0.06806826,-0.039606594,0.08990832,0.11148182,0.009945433,0.03444383,0.010892062,-0.06896287,-0.032665446,-0.0028551128,-0.0063031954,-0.0067959605,-0.029603582,0.021693977,-0.011450699,-0.01136775,0.023607286,-0.044750564,-0.006298176,-0.05580387,0.011721973,1.1666608e-32,-0.039925452,-0.097474776,0.05064649,0.019305123,-0.020504037,-0.06644644,-0.027075972,-0.021335836,0.026739197,-0.014872201,-0.04538709,-0.011674948,0.03133393,0.06456696,0.01148174,-0.029641274,0.06758608,-0.026798604,0.02108798,0.062752575,-0.0309568,0.03948766,0.05753959,-0.014978875,0.085153535,-0.03091576,-0.025993964,-0.046717618,-0.056728758,0.012208608,0.03501581,-0.06422932,-0.07059655,-0.036053672,-0.0031727052,-0.029571839,0.0012257454,-0.07043346,-0.078745395,0.03154579,0.100282244,-0.09430239,0.012027931,0.02680734,-0.01625994,0.04685353,-0.03537896,-0.0018725314,0.0036635443,0.042333063,0.011239272,-0.038848247,0.055934686,0.0066151624,-0.03939483,-0.051141396,-0.03422035,-0.029372001,0.05450848,0.06455032,-0.061758604,-0.005436213,-0.030496152,-0.03212721,-0.06995076,-0.07027619,-0.09002894,-0.051605783,-0.040920176,0.02326058,-0.0030791215,-0.040716164,0.022315074,-0.022320688,-0.029383296,-0.0419694,-0.041802984,0.031481832,-0.02031075,0.12421471,0.03781075,0.060122784,0.023179779,-0.0033032817,0.009584329,0.05871003,-0.0018253115,0.022963697,0.14000589,0.017287426,0.008438205,0.024892991,-0.054767445,0.06112173,-0.013771347,-1.0866887e-32,0.011800608,-0.040420502,-0.06345663,0.07846382,0.01673358,-0.015040381,0.08127915,0.021219427,0.061268184,-0.12021739,0.032299697,-0.011676788,0.05121698,-0.009175273,0.020001506,0.15203993,-0.008238792,0.073937185,-0.032471593,0.0021923308,-0.03465067,0.054580722,0.015609914,0.037679356,0.010776934,0.025314499,-0.0067880335,-0.017011702,-0.00096773787,0.020780014,0.10541647,-0.03954817,-0.039947193,0.026972277,0.017752508,-0.077891946,0.091559045,-0.036085535,0.014448982,0.039444365,0.045968458,0.11717563,0.02707896,-0.013028659,0.005867792,-0.015484282,-0.0039125187,-0.06888233,-0.07533624,-0.009730957,0.13468206,-0.0124576315,0.075807385,-0.037544247,0.013906157,-0.026567936,0.056794714,-0.0047448864,-0.011282698,0.036520507,-0.03536235,-0.04237178,0.052251086,0.016400691,0.038716048,0.05565811,0.04745912,-0.027545838,-0.035144262,-0.056147892,0.0013253965,-0.018321814,-0.0017956959,0.027516946,-0.0056910906,0.044047043,-0.07418234,0.086336635,-0.016786838,0.020460753,-0.008385782,-0.040294666,-0.016603906,0.031219028,-0.025618076,0.07908897,-0.069350205,-0.008298839,0.058562316,0.022634605,-0.0731443,-0.054507885,-0.029961262,0.11876451,0.11544134,-4.5273566e-08,0.07726018,-0.15614818,-0.05600001,-0.0017880521,-0.0063731577,0.016584117,0.0690667,-0.0025456338,0.07352263,0.03481873,0.0035400805,0.07842809,-0.061696466,0.06202106,0.0099046165,-0.035918135,0.02136074,0.062228262,-0.03311914,-0.09262442,0.07265656,0.033939492,-0.057397,0.04364875,0.041115765,-0.02535664,-0.013982006,0.014361366,0.0486887,-0.03771488,-0.060276367,0.029479133,-0.041030858,0.008029622,0.020009432,0.04396307,0.06875576,0.03086411,-0.025107354,0.07046821,-0.029018562,-0.032847207,0.043770697,-0.03810758,-0.017432412,-0.033771604,0.03626431,0.04746234,0.03678964,-0.09870645,-0.0331231,0.026180077,0.0057054544,0.0027381564,-0.05181777,0.004567809,0.022044843,-0.040740754,0.0128386915,-0.08107921,0.035357762,-0.010710019,0.008642896,-0.017705696]'::public.vector,'2026-01-12 03:13:34.893003');
"""

def seed_food_menu():
    """Seed the food_menu table with Indonesian menu data"""
    db_params = {
        "host": os.getenv("DB_HOST", "localhost"),
        "user": os.getenv("DB_USER", "boilerplate"),
        "password": os.getenv("DB_PASSWORD", "boilerplate"),
        "database": os.getenv("DB_NAME", "boilerplate_db"),
        "port": int(os.getenv("DB_PORT", 5432))
    }
    
    print(f"Connecting to database: {db_params['database']}")
    
    conn = psycopg2.connect(**db_params)
    conn.autocommit = True
    cursor = conn.cursor()
    
    # Read full SQL from seed_data.sql file
    sql_file = os.path.join(os.path.dirname(__file__), 'seed_data.sql')
    
    print(f"Reading seed data from: {sql_file}")
    with open(sql_file, 'r') as f:
        seed_sql = f.read()
    
    print("Inserting seed data...")
    try:
        cursor.execute(seed_sql)
        print("âœ“ Seed data inserted!")
    except psycopg2.errors.UniqueViolation:
        print("âš  Some records already exist (skipping duplicates)")
    
    # Verify
    cursor.execute("SELECT COUNT(*) FROM food_menu;")
    count = cursor.fetchone()[0]
    print(f"\nðŸ“Š Total records in food_menu: {count}")
    
    cursor.execute("SELECT nama_menu, kategori FROM food_menu ORDER BY id;")
    for row in cursor.fetchall():
        print(f"  â€¢ {row[0]} ({row[1]})")
    
    cursor.close()
    conn.close()
    print("\nâœ… Seeding complete!")

if __name__ == "__main__":
    seed_food_menu()
